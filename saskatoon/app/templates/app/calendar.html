{% extends "app/base_site.html" %}
{% load staticfiles %}
{% load i18n %}
{% load bootstrap3 %}


{% block title %} Form Advanced {% endblock title %}

{% block stylesheets %}
  {{ block.super }}
  <!-- FullCalendar -->
  <link href="/static/vendors/fullcalendar/dist/fullcalendar.min.css" rel="stylesheet">
  <link href="/static/vendors/fullcalendar/dist/fullcalendar.print.css" rel="stylesheet" media="print">

{% endblock stylesheets %}

{% block content %}
  <div class="right_col" role="main">
    <div class="">
      <div class="clearfix"></div>
      <div class="row">
        <div class="col-md-12">
          <div class="x_panel">
            <div class="x_title">
              <h2>{% trans "Harvest calendar" %} <small> {% trans "Choose a pick!" %}</small></h2>
              <div class="clearfix"></div>
            </div>
            <div class="x_content">
                {% if messages %}
                    {% for message in messages %}
                      <div class="alert alert-success alert-dismissible fade in" role="alert">
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">×</span>
                        </button>
                        <strong>{{ message }}</strong>
                      </div>
                   {% endfor %}
                {% endif %}
              <div id='calendar'></div>

            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- calendar modal -->
    <div id="CalenderModalEdit" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">

          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            <h4 class="modal-title text-center" id="myModalLabel2">{% trans "Request to participate" %} - <span id="trees"></span>, <span id="title"></span></h4>
          </div>
          <div class="modal-body">

         <!-- top tiles -->

          <div class="row tile_count">
            <div class="col-md-6 col-sm-4 col-xs-6 tile_stats_count">
              <span class="count_top"><i class="fa fa-clock-o"></i> {% trans "Schedule" %}</span>
              <div class="count" id="start_date_str"></div>
              <span class="count_bottom"><i id="start_time"></i><i> {% trans "to" %} </i><i id="end_time"></i></span>
            </div>
            <div class="col-md-3 col-sm-4 col-xs-6 tile_stats_count">
              <span class="count_top"><i class="fa fa-user"></i> Pickers required</span>
              <div class="count" id="nb_required_pickers"></div>
            </div>
            <div class="col-md-3 col-sm-4 col-xs-6 tile_stats_count">
              <span class="count_top"><i class="fa fa-user"></i> Requests so far</span>
              <div class="count green" id="nb_requests"></div>
            </div>
          </div>
          <!-- /top tiles -->
             <blockquote>
                <p id="description"></p>
             </blockquote>

         {% if user.is_authenticated %}
            <div class="row">
              <a id="harvest_url" class="btn btn-default pull-right" href="">{% trans "Full harvest details" %}</a>
            </div>
         {% endif %}

            <div id="testmodal2" style="padding: 5px 20px;">

                   <form id="form_request" method="post" action="">
                       {% csrf_token %}
                       {% bootstrap_form form_request %}
                       <input type="hidden" name="harvest_id" value="" id="harvest_id" />
                  {% buttons %}
                      <button type="button" class="btn btn-default antoclose2" data-dismiss="modal">Close</button>
                      <button type="submit" class="btn btn-primary antosubmit2">{% trans "Send" %}</button>
                  {% endbuttons %}
                   </form>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="fc_edit" data-toggle="modal" data-target="#CalenderModalEdit"></div>
    <!-- /calendar modal -->
  </div>
{% endblock content %}

{% block javascripts %}
  {{ block.super }}
  <!-- FullCalendar -->
  <script src="/static/vendors/moment/min/moment.min.js"></script>
  <script src="/static/vendors/fullcalendar/dist/fullcalendar.min.js"></script>
    <script>
        $(document).ready(function() {
            $('#calendar').fullCalendar({
                events: '/jsoncal/',
                header: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'month,basicWeek,basicDay'
                },
                eventLimit: true,
                eventClick:  function(event, jsEvent, view) {
                    $('#title').html(event.title);
                    $('#harvest_id').attr('value', event.harvest_id);
                    $('#description').html(event.description);
                    $('#trees').html(event.trees);
                    $('#nb_required_pickers').html(event.nb_required_pickers);
                    $('#nb_requests').html(event.nb_requests);
                    $('#start_date_str').html(event.start_date_str);
                    $('#start_time').html(event.start_time);
                    $('#end_time').html(event.end_time);
                    $('#form_request').attr('action', event.url);
                    $('#harvest_url').attr('href', "/harvest/"+event.harvest_id);
                    $('#CalenderModalEdit').modal();
                    return false;
                }
            });
        });
    </script>
{% endblock javascripts %}
